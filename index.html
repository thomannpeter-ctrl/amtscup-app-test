<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui;background:#eef2f7;margin:0}
.container{max-width:1200px;margin:auto;padding:1rem}
.card{background:#fff;border-radius:14px;padding:1rem;margin-bottom:1rem}
h1,h2{color:#1e3a8a}
table{width:100%;border-collapse:collapse;font-size:.9rem}
th,td{border:1px solid #e5e7eb;padding:.4rem;text-align:center}
th{background:#dbeafe}
input,select{width:100%;padding:.4rem}
.sum{background:#f3f4f6;font-weight:700}
.winner{background:#dcfce7;font-weight:800;padding:.6rem;border-radius:999px}
</style>
</head>

<body>
<div class="container">
<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<input id="chef" placeholder="Name Gruppenchef">
<input id="email" placeholder="E-Mail">
</div>

<div class="card">
<h2>2. Gruppenwahl</h2>
<select id="g1"></select>
<select id="g2"></select>
<select id="g3"></select>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner">Noch keine Resultate</div>
</div>

</div>

<script>
const ZUSCHLAG_MAP = {
  "Standard":0,"FG":0,"Karabiner":4,"57/02":8,"57/03":4,"90BK":4,"90RK":4
};

async function loadGroups(){
  const t = await (await fetch("gruppen.txt")).text();
  const g = t.split(/\r?\n/).filter(x=>x.trim());
  ["g1","g2","g3"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>â€” wÃ¤hlen â€”</option>";
    g.forEach(x=>{
      const o=document.createElement("option");
      o.value=o.textContent=x;
      s.appendChild(o);
    });
    s.onchange=render;
  });
}

function render(){
  document.getElementById("groups").innerHTML="";
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
    <h2>${g}</h2>
    <table>
    <thead><tr>
    <th>#</th><th>Name</th><th>Jahrgang</th><th>SportgerÃ¤t</th>
    <th>Resultat</th><th>Zuschlag</th><th>Total</th>
    </tr></thead>
    <tbody></tbody>
    <tfoot>
    <tr class="sum"><td colspan="4">Summen</td>
    <td id="sr${n}">0</td><td id="sz${n}">0</td><td id="st${n}">0</td>
    </tr></tfoot></table>`;
    const tb=c.querySelector("tbody");
    for(let i=1;i<=5;i++){
      tb.innerHTML+=`
      <tr>
      <td>${i}</td>
      <td><input></td>
      <td><input type="number"></td>
      <td>
        <select onchange="calc(${n})">
        <option></option>
        ${Object.keys(ZUSCHLAG_MAP).map(k=>`<option>${k}</option>`).join("")}
        </select>
      </td>
      <td><input type="number" oninput="calc(${n})"></td>
      <td class="z">0</td>
      <td class="t">0</td>
      </tr>`;
    }
    document.getElementById("groups").appendChild(c);
  });
}

function calc(n){
  let sr=0,sz=0,st=0;
  document.querySelectorAll(`#groups .card:nth-child(${n}) tbody tr`).forEach(tr=>{
    const sel=tr.querySelector("select").value;
    const res=+tr.querySelector("input[type=number]").value||0;
    const z=ZUSCHLAG_MAP[sel]||0;
    tr.querySelector(".z").textContent=z;
    tr.querySelector(".t").textContent=res+z;
    sr+=res; sz+=z; st+=res+z;
  });
  document.getElementById("sr"+n).textContent=sr;
  document.getElementById("sz"+n).textContent=sz;
  document.getElementById("st"+n).textContent=st;
  calcWinner();
}

function calcWinner(){
  const totals=[];
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    totals.push({g,total:+document.getElementById("st"+n).textContent});
  });
  totals.sort((a,b)=>b.total-a.total);
  if(totals.length<2) return;
  document.getElementById("winner").textContent =
    "ðŸ† Sieger: "+totals[0].g+" / "+totals[1].g;
}

loadGroups();
</script>
</body>
</html>
