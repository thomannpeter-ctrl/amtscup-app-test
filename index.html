<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0}
.container{max-width:1200px;margin:auto;padding:1rem}
h1{color:#1e3a8a}
h2{color:#1d4ed8}
.card{background:#fff;border-radius:14px;padding:1rem 1.25rem;
box-shadow:0 4px 10px rgba(15,23,42,.08);margin-bottom:1rem}
.row{display:flex;gap:.75rem;flex-wrap:wrap}
.field{flex:1;min-width:200px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.45rem;border-radius:8px;border:1px solid #cbd5f5}

table{width:100%;border-collapse:collapse;font-size:.85rem;margin-top:.5rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
tfoot td{background:#f3f4f6;font-weight:700}

.winner{padding:.6rem 1rem;border-radius:999px;font-weight:700;margin-top:.5rem}
.win{background:#dcfce7;color:#166534}
.draw{background:#fef9c3;color:#854d0e}

button{
border:none;border-radius:999px;padding:.8rem 1.2rem;
font-size:1rem;cursor:pointer;background:#2563eb;color:#fff;width:100%
}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<!-- Gruppenchef -->
<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
  <div class="field">
    <label>Name</label>
    <input id="chef">
  </div>
  <div class="field">
    <label>E-Mail</label>
    <input id="email" type="email">
  </div>
</div>
</div>

<!-- Gruppenwahl -->
<div class="card">
<h2>2. Gruppenwahl</h2>
<div class="row">
  <div class="field">
    <label>Gruppe 1 *</label>
    <select id="g1" onchange="updateTitles()"></select>
  </div>
  <div class="field">
    <label>Gruppe 2 *</label>
    <select id="g2" onchange="updateTitles()"></select>
  </div>
  <div class="field">
    <label>Gruppe 3 (optional)</label>
    <select id="g3" onchange="updateTitles()"></select>
  </div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="sendResult()">ðŸ“§ Resultat senden</button>
</div>

</div>

<script>
/* ================= KONFIG ================= */
const RESULT_EMAIL = "thomannpeter@bluewin.ch";

/* ðŸ‘‰ HIER DEINE GOOGLE SCRIPT URL EINSETZEN */
const SCRIPT_URL = "HIER_DEINE_SCRIPT_URL_EINFÃœGEN";

/* ================= ZUSCHLÃ„GE ================= */
const ZUSCHLAG = {
  "Standard":0,"FG":0,"Karabiner":4,"57/02":8,"57/03":4,"90BK":4,"90RK":4
};

/* ================= GRUPPEN ================= */
async function loadGroups(){
  const r = await fetch("gruppen.txt?ts="+Date.now(),{cache:"no-store"});
  const g = r.ok ? (await r.text()).split(/\r?\n/).filter(x=>x.trim()) : [];
  ["g1","g2","g3"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Bitte wÃ¤hlen â€¦</option>";
    g.forEach(x=>{
      const o=document.createElement("option");
      o.value=o.textContent=x.trim();
      s.appendChild(o);
    });
  });
}

/* ================= TABELLEN ================= */
function createGroup(n){
  const c=document.createElement("div");
  c.className="card";
  c.id="group"+n;
  c.innerHTML=`
  <h2 id="title${n}">Gruppe ${n}</h2>
  <table>
    <thead>
      <tr>
        <th>#</th><th>Name</th><th>Jahrgang</th>
        <th>SportgerÃ¤t</th><th>Resultat</th>
        <th>Zuschlag</th><th>Total</th>
      </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr>
        <td colspan="4">Summen</td>
        <td id="sr${n}">0</td>
        <td id="sz${n}">0</td>
        <td id="st${n}">0</td>
      </tr>
    </tfoot>
  </table>`;
  const tb=c.querySelector("tbody");
  for(let i=1;i<=5;i++){
    tb.innerHTML+=`
    <tr>
      <td>${i}</td>
      <td><input></td>
      <td><input type="number"></td>
      <td>
        <select onchange="calc(${n})">
          <option></option>
          ${Object.keys(ZUSCHLAG).map(x=>`<option>${x}</option>`).join("")}
        </select>
      </td>
      <td><input type="number" oninput="calc(${n})"></td>
      <td class="z">0</td>
      <td class="t">0</td>
    </tr>`;
  }
  document.getElementById("groups").appendChild(c);
}

/* ================= BERECHNUNG ================= */
function calc(n){
  let sr=0,sz=0,st=0;
  document.querySelectorAll(`#group${n} tbody tr`).forEach(tr=>{
    const sel=tr.querySelector("select").value;
    const res=+tr.querySelectorAll("input")[2].value||0;
    const z=ZUSCHLAG[sel]||0;
    tr.querySelector(".z").textContent=z;
    tr.querySelector(".t").textContent=res+z;
    sr+=res; sz+=z; st+=res+z;
  });
  sr${n}.textContent=sr;
  sz${n}.textContent=sz;
  st${n}.textContent=st;
  calcWinner();
}

/* ================= TITEL ================= */
function updateTitles(){
  [1,2,3].forEach(n=>{
    const v=document.getElementById("g"+n).value;
    document.getElementById("title"+n).textContent=
      v?`Gruppe ${n}: ${v}`:`Gruppe ${n}`;
  });
}

/* ================= SIEGER ================= */
function calcWinner(){
  const arr=[
    {n:1,v:+st1.textContent},
    {n:2,v:+st2.textContent},
    {n:3,v:+st3.textContent}
  ].filter(x=>x.v>0);

  const w=document.getElementById("winner");
  if(arr.length<2){w.textContent="Noch keine Resultate";return;}

  arr.sort((a,b)=>b.v-a.v);

  if(arr.length===2){
    w.className="winner win";
    w.textContent=`ðŸ† Sieger: Gruppe ${arr[0].n} (${arr[0].v})`;
  }else{
    w.className="winner draw";
    w.textContent=
      `ðŸ¥‡ Gruppe ${arr[0].n} (${arr[0].v}) | ðŸ¥ˆ Gruppe ${arr[1].n} (${arr[1].v})`;
  }
}

/* ================= SENDEN ================= */
function sendResult(){
  let mail="AMTSCUP CUP-DUELL\n\n";
  mail+=`Gruppenchef: ${chef.value}\nE-Mail: ${email.value}\n\n`;

  const entries=[];

  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    document.querySelectorAll(`#group${n} tbody tr`).forEach(tr=>{
      const i=tr.querySelectorAll("input");
      const name=i[0].value;
      if(!name) return;
      entries.push({
        disziplin:"Amtscup",
        chef:chef.value,
        email:email.value,
        gruppe:g,
        name:name,
        jahrgang:i[1].value,
        resultat:i[2].value,
        zuschlag:tr.querySelector(".z").textContent,
        total:tr.querySelector(".t").textContent
      });
    });
  });

  fetch(SCRIPT_URL,{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:"payload="+encodeURIComponent(JSON.stringify({entries}))
  });

  location.href=
    "mailto:"+RESULT_EMAIL+
    "?subject="+encodeURIComponent("Amtscup Cup-Duell â€“ Resultat")+
    "&body="+encodeURIComponent(mail);
}

/* ================= START ================= */
loadGroups();
createGroup(1);
createGroup(2);
createGroup(3);
</script>

</body>
</html>
