<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup ‚Äì Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0;color:#111827}
.container{max-width:1200px;margin:auto;padding:1rem}
h1{color:#1e3a8a}
h2{color:#1d4ed8;margin:.5rem 0}
.card{background:#fff;border-radius:14px;padding:1rem 1.25rem;box-shadow:0 4px 10px rgba(15,23,42,.08);margin-bottom:1rem}
.row{display:flex;gap:.75rem;flex-wrap:wrap}
.field{flex:1;min-width:200px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.5rem;border-radius:8px;border:1px solid #cbd5f5}

table{width:100%;border-collapse:collapse;font-size:.85rem;margin-top:.5rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
tfoot th{background:#eff6ff}
.sum{background:#f3f4f6;font-weight:700}

button{
  border:none;
  border-radius:999px;
  padding:.7rem 1.2rem;
  font-size:1rem;
  cursor:pointer;
  background:#2563eb;
  color:white;
  width:100%;
}

.winner{
  margin-top:.5rem;
  padding:.6rem;
  border-radius:999px;
  font-weight:700;
  background:#dcfce7;
  color:#166534;
}

@media(max-width:768px){
  table{display:block;overflow-x:auto}
}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup ‚Äì Cup-Duell</h1>

<!-- Gruppenchef -->
<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
  <div class="field">
    <label>Name</label>
    <input id="chef">
  </div>
  <div class="field">
    <label>E-Mail</label>
    <input id="email" type="email">
  </div>
</div>
</div>

<!-- Gruppenwahl -->
<div class="card">
<h2>2. Gruppenwahl</h2>
<div class="row">
  <div class="field">
    <label>Gruppe 1 *</label>
    <select id="g1" onchange="updateTitles()"></select>
  </div>
  <div class="field">
    <label>Gruppe 2 *</label>
    <select id="g2" onchange="updateTitles()"></select>
  </div>
  <div class="field">
    <label>Gruppe 3 (optional)</label>
    <select id="g3" onchange="updateTitles()"></select>
  </div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winnerBox" class="winner">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="sendResult()">üìß Resultat senden</button>
</div>

</div>

<script>
/* ================= KONFIG ================= */
const SCRIPT_URL = "HIER_DEINE_WEBAPP_URL_EINF√úGEN";

/* ================= SPORTGER√ÑTE ================= */
const SPORTGERAETE = [
  {name:"",z:0},
  {name:"Standard",z:0},
  {name:"Karabiner",z:4},
  {name:"57/02",z:8},
  {name:"57/03",z:4},
  {name:"90BK",z:4},
  {name:"90RK",z:4}
];

/* ================= GRUPPEN ================= */
async function loadGroups(){
  const r = await fetch("gruppen.txt?ts="+Date.now());
  const g = r.ok ? (await r.text()).split(/\r?\n/).filter(x=>x.trim()) : [];
  ["g1","g2","g3"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Bitte w√§hlen ‚Ä¶</option>";
    g.forEach(x=>{
      const o=document.createElement("option");
      o.value=o.textContent=x.trim();
      s.appendChild(o);
    });
  });
}

/* ================= TABELLEN ================= */
function createGroup(n){
  const c=document.createElement("div");
  c.className="card";
  c.id="group"+n;
  c.innerHTML=`
    <h2 id="title${n}">Gruppe ${n}</h2>
    <table>
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>Jahrgang</th>
          <th>Sportger√§t</th><th>Resultat</th>
          <th>Zuschlag</th><th>Total</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <th colspan="6">Summe</th>
          <th id="sum${n}" class="sum">0</th>
        </tr>
      </tfoot>
    </table>`;
  const tb=c.querySelector("tbody");
  for(let i=1;i<=5;i++){
    tb.innerHTML+=`
      <tr>
        <td>${i}</td>
        <td><input></td>
        <td><input type="number"></td>
        <td>
          <select onchange="recalc(this)">
            ${SPORTGERAETE.map(g=>`<option>${g.name}</option>`).join("")}
          </select>
        </td>
        <td><input type="number" oninput="recalc(this)"></td>
        <td class="z"></td>
        <td class="t"></td>
      </tr>`;
  }
  document.getElementById("groups").appendChild(c);
}

function recalc(el){
  const tr=el.closest("tr");
  const res=+tr.children[4].firstChild.value||0;
  const g=SPORTGERAETE.find(x=>x.name===tr.children[3].firstChild.value);
  const z=g?g.z:0;
  tr.children[5].textContent=z||"";
  tr.children[6].textContent=res+z||"";
  calcAll();
}

function calcAll(){
  [1,2,3].forEach(n=>{
    let s=0;
    document.querySelectorAll(`#group${n} .t`).forEach(c=>s+=+c.textContent||0);
    const e=document.getElementById("sum"+n);
    if(e)e.textContent=s;
  });
  updateWinner();
}

function updateTitles(){
  [1,2,3].forEach(n=>{
    const v=document.getElementById("g"+n).value;
    document.getElementById("title"+n).textContent=v||`Gruppe ${n}`;
  });
}

function updateWinner(){
  const data=[];
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    const s=+document.getElementById("sum"+n)?.textContent||0;
    if(g&&s)data.push({g,s});
  });
  if(data.length<2)return;
  data.sort((a,b)=>b.s-a.s);
  document.getElementById("winnerBox").innerHTML=
    data.length===2
    ?`üèÜ Sieger: ${data[0].g} (${data[0].s})`
    :`ü•á ${data[0].g} (${data[0].s})<br>ü•à ${data[1].g} (${data[1].s})`;
}

/* ================= SENDEN ================= */
function sendResult(){
  const entries=[];
  [1,2,3].forEach(n=>{
    const gruppe=document.getElementById("g"+n).value;
    if(!gruppe)return;
    document.querySelectorAll(`#group${n} tbody tr`).forEach(tr=>{
      const name=tr.children[1].firstChild.value;
      const jahr=tr.children[2].firstChild.value;
      const res=tr.children[4].firstChild.value;
      const sum=document.getElementById("sum"+n).textContent;
      if(!name&&!res)return;
      entries.push({
        chef:chef.value,
        email:email.value,
        gruppe,
        name,
        jahrgang:jahr,
        resultat:res,
        summe:sum
      });
    });
  });
  fetch(SCRIPT_URL,{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:"payload="+encodeURIComponent(JSON.stringify({entries}))
  });
}

/* ================= START ================= */
loadGroups();
createGroup(1);
createGroup(2);
createGroup(3);
</script>

</body>
</html>
