<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0;color:#111827}
.container{max-width:1100px;margin:auto;padding:1rem}
h1{color:#1e3a8a}
h2{color:#1d4ed8;margin:0 0 .5rem}
.card{background:#fff;border-radius:14px;padding:1rem 1.25rem;box-shadow:0 4px 10px rgba(15,23,42,.08);margin-bottom:1rem}
.row{display:flex;flex-wrap:wrap;gap:.75rem}
.field{flex:1;min-width:180px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.5rem;border-radius:8px;border:1px solid #cbd5f5}

table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{border:1px solid #e5e7eb;padding:.4rem;text-align:center}
th{background:#dbeafe}
.sum{background:#f3f4f6;font-weight:700}

button{
  border:none;
  border-radius:999px;
  padding:.7rem 1.2rem;
  font-size:1rem;
  cursor:pointer;
  background:#2563eb;
  color:white;
  width:100%;
}

.winner-box{
  padding:.6rem 1rem;
  border-radius:999px;
  font-weight:700;
}
.winner{background:#dcfce7;color:#166534}
.draw{background:#fef9c3;color:#854d0e}
.none{background:#e5e7eb}

@media(max-width:768px){
  .row{flex-direction:column}
  table{display:block;overflow-x:auto}
}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<!-- Gruppenchef -->
<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
  <div class="field">
    <label>Name</label>
    <input id="chef">
  </div>
  <div class="field">
    <label>E-Mail</label>
    <input id="email" type="email">
  </div>
</div>
</div>

<!-- Gruppen -->
<div class="card">
<h2>2. Gruppen</h2>
<div class="row">
  <div class="field">
    <label>Gruppe 1 *</label>
    <select id="g1"></select>
  </div>
  <div class="field">
    <label>Gruppe 2 *</label>
    <select id="g2"></select>
  </div>
  <div class="field">
    <label>Gruppe 3 (optional)</label>
    <select id="g3"></select>
  </div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winnerBox" class="winner-box none">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="sendResult()">ðŸ“§ Resultat senden</button>
</div>

</div>

<script>
const RESULT_EMAIL="thomannpeter@bluewin.ch";

async function loadGroups(){
  const r=await fetch("gruppen.txt?ts="+Date.now(),{cache:"no-store"});
  const g=(await r.text()).split(/\r?\n/).filter(x=>x.trim());
  ["g1","g2","g3"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Bitte wÃ¤hlen â€¦</option>";
    g.forEach(x=>{
      const o=document.createElement("option");
      o.value=o.textContent=x;
      s.appendChild(o);
    });
  });
}

function createGroup(n){
  const c=document.createElement("div");
  c.className="card";
  c.id="group"+n;
  c.innerHTML=`
  <h2>Gruppe ${n}</h2>
  <table>
    <thead><tr><th>#</th><th>Name</th><th>Jahrgang</th><th>Resultat</th></tr></thead>
    <tbody></tbody>
    <tfoot><tr><th colspan="3">Summe</th><th id="sum${n}" class="sum">0</th></tr></tfoot>
  </table>`;
  const tb=c.querySelector("tbody");
  for(let i=1;i<=5;i++){
    tb.innerHTML+=`
    <tr>
      <td>${i}</td>
      <td><input></td>
      <td><input type="number"></td>
      <td><input type="number" oninput="calc(${n})"></td>
    </tr>`;
  }
  document.getElementById("groups").appendChild(c);
}

function calc(n){
  let s=0;
  document.querySelectorAll(`#group${n} tbody input[type=number]`)
    .forEach(i=>s+=+i.value||0);
  document.getElementById("sum"+n).textContent=s;
  updateWinner();
}

function updateWinner(){
  const sums=[
    {name:g1.value,total:+sum1.textContent||0},
    {name:g2.value,total:+sum2.textContent||0},
    {name:g3.value,total:+sum3.textContent||0}
  ].filter(x=>x.name && x.total>0);

  const box=document.getElementById("winnerBox");
  box.className="winner-box";

  if(sums.length<2){
    box.classList.add("none");
    box.textContent="Noch keine Resultate";
    return;
  }

  sums.sort((a,b)=>b.total-a.total);
  const top2=sums.slice(0,2);

  if(top2[0].total===top2[1].total){
    box.classList.add("draw");
    box.textContent="Unentschieden: "+top2[0].name+" / "+top2[1].name;
  }else{
    box.classList.add("winner");
    box.textContent="ðŸ† Sieger: "+top2[0].name;
  }
}

function sendResult(){
  let body="AMTSCUP CUP-DUELL\n\n";
  body+="Gruppenchef: "+chef.value+"\n";
  body+="E-Mail: "+email.value+"\n\n";

  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    body+="Gruppe "+n+": "+g+"\n";
    document.querySelectorAll(`#group${n} tbody tr`).forEach(tr=>{
      const i=tr.querySelectorAll("input");
      if(!i[0].value) return;
      body+=`${i[0].value};${i[1].value};${i[2].value}\n`;
    });
    body+="Summe: "+document.getElementById("sum"+n).textContent+"\n\n";
  });

  location.href="mailto:"+RESULT_EMAIL+
    "?subject="+encodeURIComponent("Amtscup Resultat")+
    "&body="+encodeURIComponent(body);
}

loadGroups();
createGroup(1);
createGroup(2);
createGroup(3);
</script>

</body>
</html>
