/* ================= GRUPPEN ANZEIGEN ================= */
["g1","g2","g3"].forEach((id,idx)=>{
  document.getElementById(id).addEventListener("change",()=>{
    const n = idx+1;
    const val = document.getElementById(id).value;

    const box = document.getElementById("group"+n);
    const title = document.getElementById("title"+n);

    if(val){
      box.style.display="block";
      title.textContent = val;
    }else{
      box.style.display="none";
    }
    updateWinner();
  });
});

/* beim Start alle Gruppen ausblenden */
[1,2,3].forEach(n=>{
  document.getElementById("group"+n).style.display="none";
});
<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0;color:#111}
.container{max-width:1200px;margin:auto;padding:1rem}
h1{color:#1e3a8a}
h2{color:#2563eb;margin:.5rem 0}
.card{background:#fff;border-radius:14px;padding:1rem 1.2rem;
box-shadow:0 4px 10px rgba(0,0,0,.08);margin-bottom:1rem}
.row{display:flex;gap:.75rem;flex-wrap:wrap}
.field{flex:1;min-width:220px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.45rem;border-radius:8px;border:1px solid #cbd5f5}

table{width:100%;border-collapse:collapse;font-size:.85rem;margin-top:.5rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
.sum{background:#f3f4f6;font-weight:700}

button{
border:none;border-radius:999px;padding:.9rem;
font-size:1rem;background:#2563eb;color:#fff;width:100%;cursor:pointer}

.winner{padding:.6rem;border-radius:999px;font-weight:700}
.w1{background:#dcfce7;color:#166534}
.w2{background:#dbeafe;color:#1d4ed8}
.none{background:#e5e7eb}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
<div class="field"><label>Name</label><input id="chef"></div>
<div class="field"><label>E-Mail</label><input id="email" type="email"></div>
</div>
</div>

<div class="card">
<h2>2. Gruppenwahl</h2>
<div class="row">
<div class="field"><label>Gruppe 1 *</label><select id="g1"></select></div>
<div class="field"><label>Gruppe 2 *</label><select id="g2"></select></div>
<div class="field"><label>Gruppe 3 (optional)</label><select id="g3"></select></div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner none">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="sendResult()">ðŸ“§ Resultat senden</button>
</div>

</div>

<script>
/* ================= KONFIG ================= */
const SCRIPT_URL = "HIER_DEIN_GOOGLE_SCRIPT_URL";
const RESULT_MAIL = "thomannpeter@bluewin.ch";

/* ================= SPORTGERÃ„TE ================= */
const GERAETE = {
 "Standard":0,
 "FG":0,
 "Karabiner":4,
 "57/02":8,
 "57/03":4,
 "90BK":4,
 "90RK":4
};

/* ================= INIT ================= */
window.addEventListener("DOMContentLoaded", async ()=>{
 createGroup(1); createGroup(2); createGroup(3);
 await loadGroups();
});

/* ================= GRUPPEN ================= */
async function loadGroups(){
 const r = await fetch("gruppen.txt?ts="+Date.now());
 const list = (await r.text()).split(/\r?\n/).filter(x=>x.trim());
 ["g1","g2","g3"].forEach(id=>{
  const s=document.getElementById(id);
  s.innerHTML="<option value=''>Bitte wÃ¤hlen â€¦</option>";
  list.forEach(g=>{
   const o=document.createElement("option");
   o.value=o.textContent=g; s.appendChild(o);
  });
 });
}

/* ================= TABELLEN ================= */
function createGroup(n){
 const d=document.createElement("div");
 d.className="card"; d.id="group"+n;
 d.innerHTML=`
 <h2 id="title${n}">Gruppe ${n}</h2>
 <table>
 <thead><tr>
 <th>#</th><th>Name</th><th>Jahrgang</th><th>SportgerÃ¤t</th>
 <th>Resultat</th><th>Zuschlag</th><th>Total</th>
 </tr></thead>
 <tbody></tbody>
 <tfoot>
 <tr><th colspan="4">Summen</th>
 <th id="sr${n}" class="sum">0</th>
 <th id="sz${n}" class="sum">0</th>
 <th id="st${n}" class="sum">0</th>
 </tr>
 </tfoot>
 </table>`;
 const tb=d.querySelector("tbody");
 for(let i=1;i<=5;i++){
  tb.innerHTML+=`
  <tr>
  <td>${i}</td>
  <td><input></td>
  <td><input type="number"></td>
  <td><select onchange="calc(${n})">
   ${Object.keys(GERAETE).map(g=>`<option>${g}</option>`).join("")}
  </select></td>
  <td><input type="number" oninput="calc(${n})"></td>
  <td class="z">0</td>
  <td class="t">0</td>
  </tr>`;
 }
 document.getElementById("groups").appendChild(d);
}

/* ================= BERECHNUNG ================= */
function calc(n){
 let sr=0,sz=0,st=0;
 document.querySelectorAll(`#group${n} tbody tr`).forEach(tr=>{
  const r=+tr.children[4].firstChild.value||0;
  const g=tr.children[3].firstChild.value;
  const z=GERAETE[g]||0;
  tr.children[5].textContent=z;
  tr.children[6].textContent=r+z;
  sr+=r; sz+=z; st+=r+z;
 });
 sr${n}.textContent=sr;
 sz${n}.textContent=sz;
 st${n}.textContent=st;
 updateWinner();
}

/* ================= SIEGER ================= */
function updateWinner(){
 const sums=[
  {n:1,v:+st1.textContent},
  {n:2,v:+st2.textContent},
  {n:3,v:+st3.textContent}
 ].filter(x=>x.v>0);
 if(!sums.length){winner.textContent="Noch keine Resultate";return;}
 sums.sort((a,b)=>b.v-a.v);
 if(sums.length===2){
  winner.className="winner w1";
  winner.textContent=`ðŸ† Sieger: Gruppe ${sums[0].n} (${sums[0].v})`;
 }else{
  winner.className="winner w1";
  winner.textContent=`ðŸ† Sieger: Gruppe ${sums[0].n} & Gruppe ${sums[1].n}`;
 }
}

/* ================= SENDEN ================= */
function sendResult(){
 let body="AMTSCUP CUP-DUELL\n\n";
 body+=`Gruppenchef: ${chef.value}\nE-Mail: ${email.value}\n\n`;
 [1,2,3].forEach(n=>{
  if(!+st${n}.textContent) return;
  body+=`Gruppe ${n}\nName;Jahrgang;GerÃ¤t;Resultat;Zuschlag;Total\n`;
  document.querySelectorAll(`#group${n} tbody tr`).forEach(tr=>{
   const i=[...tr.querySelectorAll("input,select")].map(x=>x.value);
   if(!i[0]) return;
   body+=`${i[0]};${i[1]};${i[2]};${i[3]};${tr.children[5].textContent};${tr.children[6].textContent}\n`;
  });
  body+=`SUMME;;;;${sz${n}.textContent};${st${n}.textContent}\n\n`;
 });
 location.href="mailto:"+RESULT_MAIL+
 "?subject="+encodeURIComponent("Amtscup Cup-Duell")+
 "&body="+encodeURIComponent(body);

 fetch(SCRIPT_URL,{
  method:"POST",
  headers:{"Content-Type":"application/x-www-form-urlencoded"},
  body:"payload="+encodeURIComponent(JSON.stringify({mail:body}))
 });
}
</script>
</body>
</html>
