<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Amtscup â€“ Cup-Duell</title>

<style>
*{box-sizing:border-box}
body{
  font-family:system-ui,sans-serif;
  background:#e7ded3;
  margin:0;
  color:#1f2937
}
.container{max-width:1200px;margin:auto;padding:1rem}
h1{color:#3b2f24}
h2{color:#4a3728;margin:.5rem 0}
.card{
  background:#fff;
  border-radius:14px;
  padding:1rem 1.25rem;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
  margin-bottom:1rem
}
.row{display:flex;gap:.75rem;flex-wrap:wrap}
.field{flex:1;min-width:220px}
label{font-size:.8rem;font-weight:600}
input,select{
  width:100%;
  padding:.45rem;
  border-radius:8px;
  border:1px solid #cbd5e1
}
.input-year{max-width:80px}
.input-result{max-width:70px}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{
  border:1px solid #e5e7eb;
  padding:.4rem;
  text-align:center
}
th{background:#ede4d6}
button{
  border:none;
  border-radius:999px;
  padding:.8rem;
  font-size:1rem;
  cursor:pointer;
  background:#2563eb;
  color:white;
  width:100%
}
button.save{background:#14532d}
.winner{
  padding:.7rem;
  border-radius:12px;
  font-weight:700
}
.winner-ok{background:#dcfce7;color:#166534}
.winner-none{background:#e5e7eb;color:#374151}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
  <div class="field">
    <label>Name</label>
    <input id="chef">
  </div>
  <div class="field">
    <label>E-Mail</label>
    <input id="email" type="email">
  </div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner winner-none">Noch keine Resultate</div>
</div>

<div class="card">
<button class="save" onclick="saveToGoogle()">ðŸ“Š In Google Tabelle speichern</button>
</div>

</div>

<script>
/* ================================
   GOOGLE APPS SCRIPT â€“ FIXE URL
   ================================ */
const GOOGLE_SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbx5Cv-DQoLpUicU4muK7Q0fXmSqIqdhWX9F4VEz2RrkwVe8R4WfSBGavQF9eHqoOovjWA/exec";

/* ================================
   DEMO-GRUPPEN (kannst du ersetzen)
   ================================ */
const GROUPS = [
  "2 Heim 1 A065 Trimstein Eichi FS Sius",
  "2 Gast 1 A028 Konolfingen SG Eiger"
];

function build(){
  groups.innerHTML="";
  GROUPS.forEach((name,i)=>{
    groups.appendChild(groupCard(i+1,name));
  });
}

function groupCard(n,name){
  const c=document.createElement("div");
  c.className="card";
  c.dataset.name=name;
  c.innerHTML=`
    <h2>Gruppe ${n}: ${name}</h2>
    <table>
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>Jahrgang</th>
          <th>SportgerÃ¤t</th><th>Resultat</th><th>Z</th><th>Total</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <th colspan="6">Summe</th>
          <th class="sum">0</th>
        </tr>
      </tfoot>
    </table>
  `;
  const tb=c.querySelector("tbody");
  for(let i=1;i<=5;i++){
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i}</td>
      <td><input class="n"></td>
      <td><input class="y input-year"></td>
      <td><input class="g"></td>
      <td><input class="r input-result"></td>
      <td class="z">0</td>
      <td class="t">0</td>
    `;
    tr.querySelectorAll("input").forEach(e=>e.oninput=()=>calc(c));
    tb.appendChild(tr);
  }
  return c;
}

function calc(c){
  let sum=0;
  c.querySelectorAll("tbody tr").forEach(tr=>{
    const r=+tr.querySelector(".r").value||0;
    tr.querySelector(".t").textContent=r;
    sum+=r;
  });
  c.querySelector(".sum").textContent=sum;
  winner.textContent="Resultate erfasst";
  winner.className="winner winner-ok";
}

/* ================================
   SPEICHERN NACH GOOGLE SHEETS
   ================================ */
function saveToGoogle(){
  const payload={
    chef: chef.value,
    email: email.value,
    rows:[]
  };

  document.querySelectorAll("#groups .card").forEach(c=>{
    const group=c.dataset.name;
    c.querySelectorAll("tbody tr").forEach(tr=>{
      const name=tr.querySelector(".n").value;
      const res=tr.querySelector(".r").value;
      if(!name && !res) return;
      payload.rows.push({
        gruppe: group,
        name: name,
        jahr: tr.querySelector(".y").value,
        geraet: tr.querySelector(".g").value,
        resultat: +res||0,
        zuschlag: 0,
        total: +res||0
      });
    });
  });

  fetch(GOOGLE_SCRIPT_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  alert("âœ” Daten wurden an Google Tabelle gesendet");
}

build();
</script>
</body>
</html>
