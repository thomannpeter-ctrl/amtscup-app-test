<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui;background:#eef2f7;margin:0}
.container{max-width:1100px;margin:auto;padding:1rem}
.card{background:#fff;border-radius:14px;padding:1rem;margin-bottom:1rem}
h1,h2{color:#1e3a8a;margin:.2rem 0}
.row{display:flex;gap:.7rem;flex-wrap:wrap}
input,select{width:100%;padding:.45rem;border-radius:8px;border:1px solid #cbd5f5}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
.sum{background:#f3f4f6;font-weight:700}
button{width:100%;padding:.8rem;border-radius:999px;border:none;
background:#2563eb;color:#fff;font-size:1rem}
.winner{background:#dcfce7;padding:.6rem;border-radius:999px;font-weight:700}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
<input id="chef" placeholder="Name Gruppenchef">
<input id="email" placeholder="E-Mail" type="email">
</div>
</div>

<div class="card">
<h2>2. Gruppenauswahl</h2>
<select id="g1"></select>
<select id="g2"></select>
<select id="g3"></select>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="sendResult()">ðŸ“§ Resultat senden</button>
</div>

</div>

<script>
/* ================= KONFIG ================= */
const RESULT_EMAIL = "thomannpeter@bluewin.ch";

const SPORTGERAETE = [
  ["",0],
  ["Standard",0],
  ["FG",0],
  ["Karabiner",4],
  ["57/02",8],
  ["57/03",4],
  ["90BK",4],
  ["90RK",4]
];

/* ================= GRUPPEN ================= */
async function loadGroups(){
  const res = await fetch("gruppen.txt?ts="+Date.now());
  const list = (await res.text()).split(/\r?\n/).filter(x=>x.trim());
  ["g1","g2","g3"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Bitte wÃ¤hlen â€¦</option>";
    list.forEach(g=>{
      const o=document.createElement("option");
      o.value=o.textContent=g;
      s.appendChild(o);
    });
    s.onchange=renderGroups;
  });
}

function renderGroups(){
  const c=document.getElementById("groups");
  c.innerHTML="";
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    c.appendChild(makeGroup(n,g));
  });
  calcWinner();
}

/* ================= TABELLE ================= */
function makeGroup(n,name){
  const d=document.createElement("div");
  d.className="card";
  d.innerHTML=`
  <h2>Gruppe ${n}: ${name}</h2>
  <table>
  <thead><tr>
  <th>#</th><th>Name</th><th>Jahrgang</th>
  <th>SportgerÃ¤t</th><th>Resultat</th>
  <th>Zuschlag</th><th>Total</th>
  </tr></thead>
  <tbody></tbody>
  <tfoot><tr class="sum">
  <td colspan="4">Summe</td>
  <td id="sr${n}">0</td>
  <td id="sz${n}">0</td>
  <td id="st${n}">0</td>
  </tr></tfoot></table>`;
  const tb=d.querySelector("tbody");
  for(let i=1;i<=5;i++){
    const tr=document.createElement("tr");
    tr.innerHTML=`
    <td>${i}</td>
    <td><input></td>
    <td><input type="number"></td>
    <td><select></select></td>
    <td><input type="number"></td>
    <td class="z">0</td>
    <td class="t">0</td>`;
    const sel=tr.querySelector("select");
    SPORTGERAETE.forEach(g=>{
      const o=document.createElement("option");
      o.value=g[0]; o.textContent=g[0];
      o.dataset.z=g[1];
      sel.appendChild(o);
    });
    sel.onchange=()=>calcRow(tr,n);
    tr.querySelectorAll("input").forEach(i=>i.oninput=()=>calcRow(tr,n));
    tb.appendChild(tr);
  }
  return d;
}

function calcRow(tr,n){
  const r=+tr.querySelectorAll("input")[2].value||0;
  const z=+tr.querySelector("select").selectedOptions[0].dataset.z||0;
  tr.querySelector(".z").textContent=z;
  tr.querySelector(".t").textContent=r+z;
  calcSum(n);
}

function calcSum(n){
  let sr=0,sz=0,st=0;
  document.querySelectorAll(`#groups .card:nth-of-type(${n}) tbody tr`).forEach(tr=>{
    sr+=+tr.querySelectorAll("input")[2].value||0;
    sz+=+tr.querySelector(".z").textContent||0;
    st+=+tr.querySelector(".t").textContent||0;
  });
  document.getElementById("sr"+n).textContent=sr;
  document.getElementById("sz"+n).textContent=sz;
  document.getElementById("st"+n).textContent=st;
  calcWinner();
}

/* ================= SIEGER ================= */
function calcWinner(){
  const totals=[];
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    const t=document.getElementById("st"+n);
    if(g&&t) totals.push({g,total:+t.textContent});
  });
  if(!totals.length){
    winner.textContent="Noch keine Resultate";
    return;
  }
  totals.sort((a,b)=>b.total-a.total);
  winner.textContent=
    totals.length===2
    ? `ðŸ† Sieger: ${totals[0].g} (${totals[0].total})`
    : `ðŸ† Sieger: ${totals[0].g} / ${totals[1].g}`;
}

/* ================= SENDEN ================= */
function sendResult(){
  let txt="AMTSCUP CUP-DUELL\n\n";
  txt+=`Gruppenchef: ${chef.value}\n`;
  txt+=`E-Mail: ${email.value}\n\n`;
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    txt+=`Gruppe ${n}: ${g}\n`;
    txt+=`Summe Total: ${document.getElementById("st"+n).textContent}\n\n`;
  });
  location.href=
    "mailto:"+RESULT_EMAIL+
    "?subject="+encodeURIComponent("Amtscup Resultat")+
    "&body="+encodeURIComponent(txt);
}

/* ================= START ================= */
loadGroups();
</script>
</body>
</html>
