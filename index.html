<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{font-family:system-ui;background:#eef2f7;margin:0}
.container{max-width:1200px;margin:auto;padding:1rem}
.card{background:#fff;border-radius:14px;padding:1rem;margin-bottom:1rem;box-shadow:0 4px 10px rgba(0,0,0,.08)}
h1,h2{color:#1e3a8a}
.row{display:flex;gap:.75rem;flex-wrap:wrap}
.field{flex:1;min-width:200px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.45rem;border-radius:8px;border:1px solid #cbd5f5}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
.sum{font-weight:700;background:#f3f4f6}
button{width:100%;padding:.8rem;border:none;border-radius:999px;background:#2563eb;color:#fff;font-size:1rem;cursor:pointer}
.winner{padding:.6rem;border-radius:999px;font-weight:700}
.w1{background:#dcfce7;color:#166534}
.w2{background:#dbeafe;color:#1d4ed8}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
  <div class="field"><label>Name</label><input id="chef"></div>
  <div class="field"><label>E-Mail</label><input id="email"></div>
</div>
</div>

<div class="card">
<h2>2. Gruppenwahl</h2>
<div class="row">
  <div class="field"><label>Gruppe 1 *</label><select id="g1"></select></div>
  <div class="field"><label>Gruppe 2 *</label><select id="g2"></select></div>
  <div class="field"><label>Gruppe 3 (optional)</label><select id="g3"></select></div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="send()">ðŸ“§ Resultat senden</button>
</div>

</div>

<script>
const SCRIPT_URL = "HIER_DEIN_WEBAPP_URL_EINFÃœGEN";

const SPORT = {
  "Standard":0,
  "FG":0,
  "Karabiner":4,
  "57/02":8,
  "57/03":4,
  "90BK":4,
  "90RK":4
};

function loadGroups(){
  fetch("gruppen.txt?ts="+Date.now())
  .then(r=>r.text())
  .then(t=>{
    const g=t.split(/\r?\n/).filter(x=>x.trim());
    ["g1","g2","g3"].forEach(id=>{
      const s=document.getElementById(id);
      s.innerHTML="<option></option>";
      g.forEach(x=>{
        const o=document.createElement("option");
        o.textContent=o.value=x;
        s.appendChild(o);
      });
    });
  });
}

function createGroup(n){
  const d=document.createElement("div");
  d.className="card";
  d.id="group"+n;
  d.innerHTML=`
<h2 id="title${n}">Gruppe ${n}</h2>
<table>
<thead>
<tr><th>#</th><th>Name</th><th>Jahrgang</th><th>SportgerÃ¤t</th><th>Resultat</th><th>Zuschlag</th><th>Total</th></tr>
</thead>
<tbody></tbody>
<tfoot>
<tr class="sum"><td colspan="4">Summe</td>
<td id="sr${n}">0</td><td id="sz${n}">0</td><td id="st${n}">0</td></tr>
</tfoot>
</table>`;
  const tb=d.querySelector("tbody");
  for(let i=1;i<=5;i++){
    tb.innerHTML+=`
<tr>
<td>${i}</td>
<td><input></td>
<td><input type="number"></td>
<td><select onchange="calc(${n})">
${Object.keys(SPORT).map(k=>`<option>${k}</option>`).join("")}
</select></td>
<td><input type="number" oninput="calc(${n})"></td>
<td class="z">0</td>
<td class="t">0</td>
</tr>`;
  }
  document.getElementById("groups").appendChild(d);
}

function calc(n){
  let sr=0,sz=0,st=0;
  document.querySelectorAll(`#group${n} tbody tr`).forEach(r=>{
    const res=+r.children[4].querySelector("input").value||0;
    const g=r.children[3].querySelector("select").value;
    const z=SPORT[g]||0;
    r.children[5].textContent=z;
    r.children[6].textContent=res+z;
    sr+=res; sz+=z; st+=res+z;
  });
  document.getElementById("sr"+n).textContent=sr;
  document.getElementById("sz"+n).textContent=sz;
  document.getElementById("st"+n).textContent=st;
  updateWinner();
}

function updateWinner(){
  const sums=[];
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    const t=+document.getElementById("st"+n).textContent||0;
    sums.push({g,t});
  });
  sums.sort((a,b)=>b.t-a.t);
  if(!sums.length){winner.textContent="Noch keine Resultate";return;}
  if(sums.length==2){
    winner.textContent="ðŸ† Sieger: "+sums[0].g+" ("+sums[0].t+")";
    winner.className="winner w1";
  }else{
    winner.textContent="ðŸ† Sieger: "+sums[0].g+" & "+sums[1].g;
    winner.className="winner w2";
  }
}

function send(){
  const entries=[];
  [1,2,3].forEach(n=>{
    const g=document.getElementById("g"+n).value;
    if(!g) return;
    document.querySelectorAll(`#group${n} tbody tr`).forEach(r=>{
      const name=r.children[1].querySelector("input").value;
      const res=r.children[4].querySelector("input").value;
      if(!name&&!res) return;
      entries.push({
        chef:chef.value,
        email:email.value,
        gruppe:g,
        name:name,
        jahrgang:r.children[2].querySelector("input").value,
        resultat:res,
        zuschlag:r.children[5].textContent,
        total:r.children[6].textContent
      });
    });
  });

  fetch(SCRIPT_URL,{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:"payload="+encodeURIComponent(JSON.stringify({entries}))
  });

  location.href="mailto:thomannpeter@bluewin.ch?subject=Amtscup Resultat";
}

loadGroups();
createGroup(1);createGroup(2);createGroup(3);
</script>
</body>
</html>
