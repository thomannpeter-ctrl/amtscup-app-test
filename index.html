<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Amtscup â€“ Cup-Duell</title>

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background:#f1f5f9;
}
.container {
  max-width:1200px;
  margin:auto;
  padding:1rem;
}
.card {
  background:#fff;
  border-radius:12px;
  padding:1rem;
  margin-bottom:1rem;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
h1 { color:#1e3a8a; }
h2 { color:#2563eb; margin-bottom:.5rem; }
label { font-size:.85rem; font-weight:600; }
input, select {
  padding:.5rem;
  border-radius:8px;
  border:1px solid #c7d2fe;
  width:100%;
}
table {
  width:100%;
  border-collapse:collapse;
}
th, td {
  border:1px solid #e5e7eb;
  padding:.4rem;
  text-align:center;
}
th { background:#dbeafe; }
tfoot td { font-weight:700; background:#f3f4f6; }
button {
  width:100%;
  padding:.8rem;
  border:none;
  border-radius:999px;
  background:#2563eb;
  color:#fff;
  font-size:1rem;
  cursor:pointer;
}
.winner {
  padding:.7rem;
  border-radius:999px;
  background:#dcfce7;
  font-weight:700;
}

@media(max-width:768px){
  table{display:block;overflow-x:auto;white-space:nowrap;}
}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<input id="chefName" placeholder="Name Gruppenchef">
<input id="chefMail" placeholder="E-Mail">
</div>

<div class="card">
<h2>2. Gruppenauswahl</h2>
<select id="g1"></select>
<select id="g2"></select>
<select id="g3"></select>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner">Noch keine Resultate</div>
</div>

<button onclick="sendMail()">ðŸ“§ Resultat senden</button>

</div>

<script>
const SPORTGERAETE = [
  ["",0],
  ["Standard",0],
  ["Freigewehr",0],
  ["Karabiner",4],
  ["57/02",8],
  ["57/03",4],
  ["90BK",4],
  ["90RK",4]
];

let groups = [];

async function loadGroups(){
  const res = await fetch("gruppen.txt?"+Date.now());
  const txt = await res.text();
  groups = txt.split("\n").map(l=>l.trim()).filter(Boolean);
  [g1,g2,g3].forEach(s=>{
    s.innerHTML='<option value="">Bitte wÃ¤hlenâ€¦</option>';
    groups.forEach(g=>{
      const o=document.createElement("option");
      o.value=o.textContent=g;
      s.appendChild(o);
    });
    s.onchange=renderGroups;
  });
}

function renderGroups(){
  const list=[g1.value,g2.value,g3.value].filter(Boolean);
  const wrap=document.getElementById("groups");
  wrap.innerHTML="";
  list.forEach((name,i)=>wrap.appendChild(groupTable(name,i+1)));
}

function groupTable(name,idx){
  const card=document.createElement("div");
  card.className="card";
  card.innerHTML=`<h2>Gruppe ${idx}: ${name}</h2>
<table>
<thead><tr>
<th>#</th><th>Name</th><th>Jahrgang</th><th>SportgerÃ¤t</th>
<th>Resultat</th><th>Zuschlag</th><th>Total</th>
</tr></thead>
<tbody></tbody>
<tfoot><tr><td colspan="4">Summe</td>
<td class="sr">0</td><td class="sz">0</td><td class="st">0</td></tr></tfoot>
</table>`;
  const tb=card.querySelector("tbody");
  for(let i=1;i<=5;i++){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${i}</td>
<td><input></td>
<td><input type="number"></td>
<td><select></select></td>
<td><input type="number"></td>
<td class="z">0</td>
<td class="t">0</td>`;
    const sel=tr.querySelector("select");
    SPORTGERAETE.forEach(g=>{
      const o=document.createElement("option");
      o.value=g[0]; o.textContent=g[0];
      sel.appendChild(o);
    });
    sel.onchange=()=>calc(card);
    tr.querySelectorAll("input").forEach(i=>i.oninput=()=>calc(card));
    tb.appendChild(tr);
  }
  return card;
}

function calc(card){
  let sr=0,sz=0,st=0;
  card.querySelectorAll("tbody tr").forEach(tr=>{
    const r=+tr.children[4].querySelector("input").value||0;
    const g=tr.children[3].querySelector("select").value;
    const z=SPORTGERAETE.find(x=>x[0]==g)?.[1]||0;
    tr.querySelector(".z").textContent=z;
    tr.querySelector(".t").textContent=r+z;
    sr+=r; sz+=z; st+=r+z;
  });
  card.querySelector(".sr").textContent=sr;
  card.querySelector(".sz").textContent=sz;
  card.querySelector(".st").textContent=st;
  updateWinner();
}

function updateWinner(){
  const sums=[...document.querySelectorAll(".st")].map(e=>+e.textContent);
  if(!sums.length) return;
  const max=Math.max(...sums);
  const winners=sums.map((v,i)=>v==max?`Gruppe ${i+1}`:null).filter(Boolean);
  winner.textContent = winners.join(" & ")+" ("+max+")";
}

function sendMail(){
  let body="AMTSCUP CUP-DUELL\n\n";
  body+="Gruppenchef: "+chefName.value+"\n";
  body+="E-Mail: "+chefMail.value+"\n\n";
  document.querySelectorAll(".card table").forEach((t,i)=>{
    body+="Gruppe "+(i+1)+":\n";
    t.querySelectorAll("tbody tr").forEach(tr=>{
      const n=tr.children[1].querySelector("input").value;
      if(!n) return;
      body+=`${n}; ${tr.children[2].querySelector("input").value}; ${tr.children[3].querySelector("select").value}; ${tr.children[4].querySelector("input").value}; Zuschlag ${tr.querySelector(".z").textContent}; Total ${tr.querySelector(".t").textContent}\n`;
    });
    body+="Summe Total: "+t.querySelector(".st").textContent+"\n\n";
  });
  location.href="mailto:thomannpeter@bluewin.ch?subject=Amtscup Resultat&body="+encodeURIComponent(body);
}

loadGroups();
</script>
</body>
</html>
