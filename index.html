<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:system-ui;background:#f1f5f9;margin:0}
.container{max-width:1200px;margin:auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 6px 18px rgba(0,0,0,.08)}
h1{color:#1e3a8a}
h2{color:#2563eb;margin-top:0}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #e5e7eb;padding:6px;text-align:center}
th{background:#dbeafe}
input,select{width:100%;padding:6px;border-radius:6px;border:1px solid #c7d2fe}
tfoot td{font-weight:700;background:#f8fafc}
button{width:100%;padding:14px;border:none;border-radius:999px;background:#2563eb;color:#fff;font-size:16px;cursor:pointer}
.winner{background:#dcfce7;color:#166534;padding:12px;border-radius:999px;font-weight:700}
</style>
</head>

<body>
<div class="container">
<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<input id="chef" placeholder="Name Gruppenchef">
<input id="email" placeholder="E-Mail" style="margin-top:8px">
</div>

<div class="card">
<h2>2. Gruppenauswahl</h2>
<select id="g1"><option value="">Gruppe 1 wÃ¤hlen</option></select>
<select id="g2"><option value="">Gruppe 2 wÃ¤hlen</option></select>
<select id="g3"><option value="">Gruppe 3 (optional)</option></select>
</div>

<div id="tables"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner">Noch keine Resultate</div>
</div>

<div class="card">
<button onclick="send()">ðŸ“§ Resultat senden</button>
</div>
</div>

<script>
const SCRIPT_URL = "HIER_DEINE_GOOGLE_SCRIPT_WEBAPP_URL";

const GROUPS=[
"1 Heim 1 A071 Worber SportschÃ¼tzen Querschleger",
"1 Gast 1 A001 AareschÃ¼tzen Kiesen Oppligen Aare",
"1 Gast 1 A037 Linden FS Innerbirrmoos"
];

const GERAETE=[
["",""],
["Standard",0],
["FG",0],
["Karabiner",4],
["57/02",8],
["57/03",4],
["90BK",4],
["90RK",4]
];

[g1,g2,g3].forEach(s=>{
GROUPS.forEach(g=>s.innerHTML+=`<option>${g}</option>`);
s.onchange=render;
});

function render(){
tables.innerHTML="";
[1,2,3].forEach(n=>{
const g=document.getElementById("g"+n).value;
if(!g)return;
tables.innerHTML+=groupTable(n,g);
});
calcWinner();
}

function groupTable(n,name){
let rows="";
for(let i=1;i<=5;i++){
rows+=`
<tr>
<td>${i}</td>
<td><input></td>
<td><input></td>
<td>
<select onchange="calc(this)">
${GERAETE.map(g=>`<option value="${g[1]}">${g[0]}</option>`).join("")}
</select>
</td>
<td><input type="number" oninput="calc(this)"></td>
<td class="z">0</td>
<td class="t">0</td>
</tr>`;
}
return `
<div class="card">
<h2>Gruppe ${n}: ${name}</h2>
<table id="group${n}">
<thead>
<tr><th>#</th><th>Name</th><th>Jahrgang</th><th>SportgerÃ¤t</th><th>Resultat</th><th>Zuschlag</th><th>Total</th></tr>
</thead>
<tbody>${rows}</tbody>
<tfoot>
<tr><td colspan="4">Summe</td>
<td id="sr${n}">0</td>
<td id="sz${n}">0</td>
<td id="st${n}">0</td></tr>
</tfoot>
</table>
</div>`;
}

function calc(el){
const tr=el.closest("tr");
const res=+tr.children[4].querySelector("input").value||0;
const zus=+tr.children[3].querySelector("select").value||0;
tr.children[5].textContent=zus;
tr.children[6].textContent=res+zus;
sum();
}

function sum(){
[1,2,3].forEach(n=>{
const t=document.getElementById("group"+n);
if(!t)return;
let r=0,z=0,tt=0;
t.querySelectorAll("tbody tr").forEach(tr=>{
r+=+tr.children[4].querySelector("input").value||0;
z+=+tr.children[5].textContent||0;
tt+=+tr.children[6].textContent||0;
});
sr"+n).textContent=r;
sz"+n).textContent=z;
st"+n).textContent=tt;
});
calcWinner();
}

function calcWinner(){
const res=[];
[1,2,3].forEach(n=>{
const g=document.getElementById("g"+n).value;
const t=document.getElementById("st"+n);
if(g && t && +t.textContent>0)
res.push({g,total:+t.textContent});
});
if(res.length<2){winner.textContent="Noch keine Resultate";return;}
res.sort((a,b)=>b.total-a.total);
winner.textContent=
res.length===2
?`ðŸ† Sieger: ${res[0].g} (${res[0].total})`
:`ðŸ† Sieger: ${res[0].g} (${res[0].total}) & ${res[1].g} (${res[1].total})`;
}

function send(){
const entries=[];
[1,2,3].forEach(n=>{
const g=document.getElementById("g"+n).value;
const t=document.getElementById("group"+n);
if(!g||!t)return;
t.querySelectorAll("tbody tr").forEach(r=>{
const name=r.children[1].querySelector("input").value;
const res=r.children[4].querySelector("input").value;
if(!name&&!res)return;
entries.push({
chef:chef.value,
email:email.value,
gruppe:g,
name:name,
jahrgang:r.children[2].querySelector("input").value,
resultat:res,
zuschlag:r.children[5].textContent,
total:r.children[6].textContent
});
});
});
fetch(SCRIPT_URL,{
method:"POST",
headers:{"Content-Type":"application/x-www-form-urlencoded"},
body:"payload="+encodeURIComponent(JSON.stringify({entries}))
});
location.href=
"mailto:thomannpeter@bluewin.ch?subject="+
encodeURIComponent("Amtscup Resultat")+
"&body="+encodeURIComponent("Resultat wurde erfolgreich Ã¼bermittelt.\nSiehe Google Tabelle.");
}
</script>
</body>
</html>
